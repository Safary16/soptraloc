{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard - SoptraLoc TMS{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header con reloj -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card card-ubuntu fade-in">
                <div class="card-body text-center">
                    <h2 class="mb-2">
                        <i class="fas fa-shipping-fast text-warning"></i> 
                        Panel de Control SoptraLoc
                    </h2>
                    <p class="text-muted mb-2">Sistema de Gestión de Transporte con Machine Learning</p>
                    <div id="realtime-clock" class="h5 text-primary mb-0"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Cards - Métricas Principales -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <a href="/containers/?estado=programado" class="text-decoration-none">
                <div class="card stat-card orange fade-in" style="cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    <div class="stat-icon">
                        <i class="fas fa-calendar-day"></i>
                    </div>
                    <div class="stat-number">{{ stats.programados_hoy }}</div>
                    <div class="stat-label">Programados Hoy</div>
                </div>
            </a>
        </div>
        <div class="col-md-3 mb-3">
            <a href="/containers/" class="text-decoration-none">
                <div class="card stat-card purple fade-in" style="cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    <div class="stat-icon">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="stat-number">{{ stats.con_demurrage }}</div>
                    <div class="stat-label">Demurrage Pendiente</div>
                </div>
            </a>
        </div>
        <div class="col-md-3 mb-3">
            <a href="/containers/?estado=liberado" class="text-decoration-none">
                <div class="card stat-card dark fade-in" style="cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    <div class="stat-icon">
                        <i class="fas fa-unlock"></i>
                    </div>
                    <div class="stat-number">{{ stats.liberados }}</div>
                    <div class="stat-label">Liberados</div>
                </div>
            </a>
        </div>
        <div class="col-md-3 mb-3">
            <a href="/containers/?estado=en_ruta" class="text-decoration-none">
                <div class="card stat-card orange fade-in" style="cursor: pointer; transition: transform 0.2s;" onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    <div class="stat-icon">
                        <i class="fas fa-truck-moving"></i>
                    </div>
                    <div class="stat-number">{{ stats.en_ruta }}</div>
                    <div class="stat-label">En Ruta</div>
                </div>
            </a>
        </div>
    </div>

    <!-- Alertas y Totales -->
    <div class="row mb-4">
        <div class="col-md-4 mb-3">
            <div class="card border-warning">
                <div class="card-body">
                    <h5 class="card-title text-warning">
                        <i class="fas fa-exclamation-triangle"></i> Alertas
                    </h5>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="text-muted">Sin Asignar (próximas 48h)</span>
                        <span class="badge bg-warning text-dark fs-5">{{ stats.sin_asignar }}</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <a href="/containers/" class="text-decoration-none">
                <div class="card border-primary" style="cursor: pointer;">
                    <div class="card-body">
                        <h5 class="card-title text-primary">
                            <i class="fas fa-users"></i> Conductores
                        </h5>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted">Total Disponibles</span>
                            <span class="badge bg-primary fs-5">{{ stats.conductores }}</span>
                        </div>
                    </div>
                </div>
            </a>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card border-success">
                <div class="card-body">
                    <h5 class="card-title text-success">
                        <i class="fas fa-check-circle"></i> Totales Activos
                    </h5>
                    <div class="row text-center small mt-2">
                        <div class="col-4">
                            <strong>{{ stats.por_arribar }}</strong><br>
                            <small class="text-muted">Por Arribar</small>
                        </div>
                        <div class="col-4">
                            <strong>{{ stats.programados }}</strong><br>
                            <small class="text-muted">Programados</small>
                        </div>
                        <div class="col-4">
                            <strong>{{ stats.vacios }}</strong><br>
                            <small class="text-muted">Vacíos</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabla de Programaciones Urgentes -->
    <div class="row">
        <div class="col-12">
            <div class="card fade-in">
                <div class="card-header card-header-ubuntu">
                    <i class="fas fa-list"></i> Programaciones Prioritarias (Top 10)
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-ubuntu table-hover">
                            <thead>
                                <tr>
                                    <th><i class="fas fa-box"></i> Contenedor</th>
                                    <th><i class="fas fa-warehouse"></i> Centro Distribución</th>
                                    <th><i class="fas fa-user"></i> Conductor</th>
                                    <th><i class="fas fa-calendar"></i> Días Programación</th>
                                    <th><i class="fas fa-clock"></i> Días Demurrage</th>
                                    <th><i class="fas fa-flag"></i> Urgencia</th>
                                </tr>
                            </thead>
                            <tbody id="programaciones-tbody">
                                <tr>
                                    <td colspan="6" class="text-center">
                                        <div class="spinner-ubuntu"></div>
                                        <p class="text-muted">Cargando datos...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer">
                    <div class="row">
                        <div class="col-md-6">
                            <small class="text-muted">
                                <i class="fas fa-sync-alt"></i> Actualización automática cada 30 segundos
                            </small>
                        </div>
                        <div class="col-md-6 text-end">
                            <a href="/api/programaciones/dashboard/" class="btn btn-sm btn-ubuntu-outline" target="_blank">
                                <i class="fas fa-code"></i> Ver API
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Leyenda de Urgencias -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <h6 class="card-title"><i class="fas fa-info-circle"></i> Leyenda de Urgencias</h6>
                    <div class="d-flex flex-wrap gap-3">
                        <div>
                            <span class="badge badge-urgencia-critica">CRÍTICA</span>
                            <small class="text-muted ms-2">Menos de 1 día</small>
                        </div>
                        <div>
                            <span class="badge badge-urgencia-alta">ALTA</span>
                            <small class="text-muted ms-2">1-2 días</small>
                        </div>
                        <div>
                            <span class="badge badge-urgencia-media">MEDIA</span>
                            <small class="text-muted ms-2">2-3 días</small>
                        </div>
                        <div>
                            <span class="badge badge-urgencia-baja">BAJA</span>
                            <small class="text-muted ms-2">Más de 3 días</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Links rápidos -->
    <div class="row mt-4 mb-4">
        <div class="col-md-4 mb-3">
            <div class="card card-ubuntu h-100">
                <div class="card-body text-center">
                    <i class="fas fa-truck fa-3x mb-3 text-primary"></i>
                    <h5>Asignación de Conductores</h5>
                    <p class="text-muted">Sistema inteligente de asignación automática</p>
                    <a href="/asignacion/" class="btn btn-ubuntu">
                        Ir a Asignación <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card card-ubuntu h-100">
                <div class="card-body text-center">
                    <i class="fas fa-cog fa-3x mb-3 text-warning"></i>
                    <h5>Panel de Administración</h5>
                    <p class="text-muted">Gestión completa del sistema</p>
                    <a href="/admin/" class="btn btn-ubuntu">
                        Ir a Admin <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card card-ubuntu h-100">
                <div class="card-body text-center">
                    <i class="fas fa-code fa-3x mb-3 text-success"></i>
                    <h5>API REST</h5>
                    <p class="text-muted">Documentación de endpoints</p>
                    <a href="/api/" class="btn btn-ubuntu">
                        Ver API <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
