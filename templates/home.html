{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard - SoptraLoc TMS{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header con reloj -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card card-ubuntu fade-in">
                <div class="card-body text-center">
                    <h2 class="mb-2">
                        <i class="fas fa-shipping-fast text-warning"></i> 
                        Panel de Control SoptraLoc
                    </h2>
                    <p class="text-muted mb-2">Sistema de Gestión de Transporte con Machine Learning</p>
                    <div id="realtime-clock" class="h5 text-primary mb-0"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card stat-card orange fade-in">
                <div class="stat-icon">
                    <i class="fas fa-box"></i>
                </div>
                <div class="stat-number" id="stat-total">-</div>
                <div class="stat-label">Programaciones Activas</div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card stat-card purple fade-in">
                <div class="stat-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="stat-number" id="stat-criticas">-</div>
                <div class="stat-label">Urgencia Crítica</div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card stat-card dark fade-in">
                <div class="stat-icon">
                    <i class="fas fa-truck"></i>
                </div>
                <div class="stat-number" id="stat-conductores">{{ stats.conductores }}</div>
                <div class="stat-label">Conductores</div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card stat-card orange fade-in">
                <div class="stat-icon">
                    <i class="fas fa-warehouse"></i>
                </div>
                <div class="stat-number" id="stat-cds">{{ stats.cds }}</div>
                <div class="stat-label">Centros de Distribución</div>
            </div>
        </div>
    </div>

    <!-- Tabla de Programaciones Urgentes -->
    <div class="row">
        <div class="col-12">
            <div class="card fade-in">
                <div class="card-header card-header-ubuntu">
                    <i class="fas fa-list"></i> Programaciones Prioritarias (Top 10)
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-ubuntu table-hover">
                            <thead>
                                <tr>
                                    <th><i class="fas fa-box"></i> Contenedor</th>
                                    <th><i class="fas fa-warehouse"></i> Centro Distribución</th>
                                    <th><i class="fas fa-user"></i> Conductor</th>
                                    <th><i class="fas fa-calendar"></i> Días Programación</th>
                                    <th><i class="fas fa-clock"></i> Días Demurrage</th>
                                    <th><i class="fas fa-flag"></i> Urgencia</th>
                                </tr>
                            </thead>
                            <tbody id="programaciones-tbody">
                                <tr>
                                    <td colspan="6" class="text-center">
                                        <div class="spinner-ubuntu"></div>
                                        <p class="text-muted">Cargando datos...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer">
                    <div class="row">
                        <div class="col-md-6">
                            <small class="text-muted">
                                <i class="fas fa-sync-alt"></i> Actualización automática cada 30 segundos
                            </small>
                        </div>
                        <div class="col-md-6 text-end">
                            <a href="/api/programaciones/dashboard/" class="btn btn-sm btn-ubuntu-outline" target="_blank">
                                <i class="fas fa-code"></i> Ver API
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Leyenda de Urgencias -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <h6 class="card-title"><i class="fas fa-info-circle"></i> Leyenda de Urgencias</h6>
                    <div class="d-flex flex-wrap gap-3">
                        <div>
                            <span class="badge badge-urgencia-critica">CRÍTICA</span>
                            <small class="text-muted ms-2">Menos de 1 día</small>
                        </div>
                        <div>
                            <span class="badge badge-urgencia-alta">ALTA</span>
                            <small class="text-muted ms-2">1-2 días</small>
                        </div>
                        <div>
                            <span class="badge badge-urgencia-media">MEDIA</span>
                            <small class="text-muted ms-2">2-3 días</small>
                        </div>
                        <div>
                            <span class="badge badge-urgencia-baja">BAJA</span>
                            <small class="text-muted ms-2">Más de 3 días</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Links rápidos -->
    <div class="row mt-4 mb-4">
        <div class="col-md-4 mb-3">
            <div class="card card-ubuntu h-100">
                <div class="card-body text-center">
                    <i class="fas fa-truck fa-3x mb-3 text-primary"></i>
                    <h5>Asignación de Conductores</h5>
                    <p class="text-muted">Sistema inteligente de asignación automática</p>
                    <a href="/asignacion/" class="btn btn-ubuntu">
                        Ir a Asignación <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card card-ubuntu h-100">
                <div class="card-body text-center">
                    <i class="fas fa-cog fa-3x mb-3 text-warning"></i>
                    <h5>Panel de Administración</h5>
                    <p class="text-muted">Gestión completa del sistema</p>
                    <a href="/admin/" class="btn btn-ubuntu">
                        Ir a Admin <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card card-ubuntu h-100">
                <div class="card-body text-center">
                    <i class="fas fa-code fa-3x mb-3 text-success"></i>
                    <h5>API REST</h5>
                    <p class="text-muted">Documentación de endpoints</p>
                    <a href="/api/" class="btn btn-ubuntu">
                        Ver API <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
