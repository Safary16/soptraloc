# üöÄ Render.com - SoptraLoc TMS v2.0# üöÄ Render.com     # üî® Build Command - Optimizado

# Sistema de gesti√≥n de transporte con ML    buildCommand: chmod +x build.sh && ./build.sh

# Deploy autom√°tico desde GitHub

    # ‚öôÔ∏è Pre-Deploy - Solo migraciones (preserva datos)

services:    preDeployCommand: |

  # üåê Aplicaci√≥n Web Django      cd soptraloc_system

  - type: web      echo "üîÑ Aplicando migraciones..."

    name: soptraloc      python manage.py migrate --settings=config.settings_production --noinput

    env: python      echo "‚úÖ Migraciones completadas"

    runtime: python    

    pythonVersion: "3.12.6"    # üìä Post-Deploy - Carga datos y crea superusuario

    repo: https://github.com/Safary16/soptraloc.git    postDeployCommand: chmod +x post_deploy.sh && ./post_deploy.shSoptraLoc TMS v2.0 Optimizado

    branch: main# Sistema TMS con Machine Learning, Reloj ATC y Alertas en Tiempo Real

    region: oregon# Actualizaci√≥n autom√°tica desde GitHub main branch

    plan: free

    services:

    # üî® Comandos de construcci√≥n  # üåê Aplicaci√≥n Web Principal

    buildCommand: chmod +x build.sh && ./build.sh  - type: web

        name: soptraloc

    # ‚öôÔ∏è Pre-Deploy: Migraciones    env: python

    preDeployCommand: |    runtime: python

      cd soptraloc_system    pythonVersion: "3.12.6"

      python manage.py migrate --settings=config.settings_production --noinput    repo: https://github.com/Safary16/soptraloc.git

        branch: main

    # üìä Post-Deploy: Datos y superusuario    region: oregon  # us-west (m√°s cerca de Chile)

    postDeployCommand: chmod +x post_deploy.sh && ./post_deploy.sh    plan: free

        

    # üöÄ Comando de inicio    # üî® Build Command - Optimizado

    startCommand: |    buildCommand: chmod +x build.sh && ./build.sh

      cd soptraloc_system && \

      gunicorn config.wsgi:application \    # ÔøΩ Pre-Deploy - Solo migraciones (preserva datos)

        --bind 0.0.0.0:$PORT \    preDeployCommand: |

        --workers 2 \      cd soptraloc_system

        --threads 4 \      echo "üîÑ Aplicando migraciones..."

        --worker-class gthread \      python manage.py migrate --settings=config.settings_production --noinput

        --timeout 120 \      echo "‚úÖ Migraciones completadas"

        --max-requests 1000 \      

        --max-requests-jitter 50 \    # üöÄ Start Command - Gunicorn optimizado

        --access-logfile - \    startCommand: |

        --error-logfile - \      cd soptraloc_system && \

        --log-level info      gunicorn config.wsgi:application \

            --bind=0.0.0.0:$PORT \

    # üîß Variables de entorno        --workers=2 \

    envVars:        --threads=4 \

      - key: PYTHON_VERSION        --worker-class=gthread \

        value: "3.12.6"        --timeout=120 \

              --max-requests=1000 \

      - key: DEBUG        --max-requests-jitter=50 \

        value: "False"        --access-logfile=- \

              --error-logfile=- \

      - key: DJANGO_SETTINGS_MODULE        --log-level=info

        value: config.settings_production      

          # üåç Health Check

      - key: SECRET_KEY    healthCheckPath: /

        generateValue: true    

          # üîß Variables de Entorno - Producci√≥n

      - key: DATABASE_URL    envVars:

        fromDatabase:      - key: PYTHON_VERSION

          name: soptraloc-db        value: "3.12.6"

          property: connectionString      

            - key: DEBUG

      - key: RENDER_EXTERNAL_HOSTNAME        value: "False"

        sync: false      

            - key: DJANGO_SETTINGS_MODULE

      - key: TZ        value: config.settings_production

        value: "America/Santiago"      

            - key: SECRET_KEY

      - key: LANG        generateValue: true

        value: "es_ES.UTF-8"      

            - key: DATABASE_URL

      - key: LC_ALL        fromDatabase:

        value: "es_ES.UTF-8"          name: soptraloc-production-db

          property: connectionString

# üóÑÔ∏è Base de datos PostgreSQL      

databases:      - key: RENDER_EXTERNAL_HOSTNAME

  - name: soptraloc-db        sync: false

    databaseName: soptraloc_prod      

    user: soptraloc      - key: TZ

    plan: free        value: "America/Santiago"

    region: oregon      

    ipAllowList: []      - key: LANG

        value: "es_ES.UTF-8"
      
      - key: LC_ALL
        value: "es_ES.UTF-8"

# üóÑÔ∏è PostgreSQL Database
databases:
  - name: soptraloc-production-db
    databaseName: soptraloc_prod
    user: soptraloc
    plan: free
    region: oregon  # Misma regi√≥n que la app
    ipAllowList: []  # Permite conexiones desde Render