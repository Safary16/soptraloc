#!/usr/bin/env bash
# Script de diagn√≥stico para problemas de login en Render

echo "============================================================"
echo "üîç DIAGN√ìSTICO DE PROBLEMAS DE LOGIN EN RENDER"
echo "============================================================"
echo ""

echo "üìã POSIBLES CAUSAS DEL PROBLEMA:"
echo ""

echo "1Ô∏è‚É£  El superusuario NO se cre√≥ en el post-deploy"
echo "   - Verificar logs de Render en la secci√≥n 'Deploy Logs'"
echo "   - Buscar: '‚úÖ Superusuario creado: admin'"
echo "   - Si dice '‚ÑπÔ∏è Superusuario ya existe' est√° OK"
echo ""

echo "2Ô∏è‚É£  La base de datos de Render es DIFERENTE a la local"
echo "   - Render usa PostgreSQL (no SQLite)"
echo "   - Los datos locales NO est√°n en Render"
echo "   - Necesitas que el post_deploy.sh se ejecute correctamente"
echo ""

echo "3Ô∏è‚É£  El post_deploy.sh NO se ejecut√≥"
echo "   - Verificar en render.yaml si est√° configurado"
echo "   - Verificar permisos (chmod +x post_deploy.sh)"
echo ""

echo "4Ô∏è‚É£  Problemas con settings_production.py"
echo "   - Django puede estar usando settings.py en vez de settings_production.py"
echo "   - Verificar variable de entorno DJANGO_SETTINGS_MODULE"
echo ""

echo "5Ô∏è‚É£  El usuario existe pero la contrase√±a est√° mal"
echo "   - Si cambiaste la contrase√±a localmente, NO afecta a Render"
echo "   - Render crea el usuario desde cero con post_deploy.sh"
echo ""

echo "============================================================"
echo "üõ†Ô∏è  SOLUCIONES:"
echo "============================================================"
echo ""

echo "OPCI√ìN A: Verificar en Render Shell (RECOMENDADO)"
echo "----------"
echo "1. Ve a tu servicio en Render Dashboard"
echo "2. Haz clic en 'Shell' en el men√∫ lateral"
echo "3. Ejecuta estos comandos:"
echo ""
echo "   cd soptraloc_system"
echo "   python manage.py shell --settings=config.settings_production"
echo ""
echo "   Luego en el shell de Python:"
echo "   >>> from django.contrib.auth.models import User"
echo "   >>> User.objects.all().count()"
echo "   >>> User.objects.filter(username='admin').exists()"
echo "   >>> admin = User.objects.get(username='admin')"
echo "   >>> admin.check_password('1234')"
echo ""

echo "OPCI√ìN B: Crear usuario manualmente en Render Shell"
echo "----------"
echo "Si el usuario NO existe, cr√©alo:"
echo ""
echo "   cd soptraloc_system"
echo "   python manage.py createsuperuser --settings=config.settings_production"
echo ""
echo "   Username: admin"
echo "   Email: admin@soptraloc.com"
echo "   Password: 1234"
echo "   Password (again): 1234"
echo ""

echo "OPCI√ìN C: Forzar re-deploy con post_deploy.sh"
echo "----------"
echo "1. Agregar un comentario vac√≠o en cualquier archivo"
echo "2. Hacer commit y push"
echo "3. Render detectar√° el cambio y har√° re-deploy"
echo "4. Verificar logs de deploy para confirmar que post_deploy.sh se ejecut√≥"
echo ""

echo "OPCI√ìN D: Resetear la contrase√±a desde Render Shell"
echo "----------"
echo "   cd soptraloc_system"
echo "   python manage.py shell --settings=config.settings_production"
echo ""
echo "   >>> from django.contrib.auth.models import User"
echo "   >>> admin = User.objects.get(username='admin')"
echo "   >>> admin.set_password('1234')"
echo "   >>> admin.save()"
echo "   >>> print('Password cambiada a: 1234')"
echo ""

echo "============================================================"
echo "üìä INFORMACI√ìN ADICIONAL:"
echo "============================================================"
echo ""
echo "Base de datos actual (LOCAL): SQLite"
echo "Base de datos en Render: PostgreSQL"
echo ""
echo "Credenciales configuradas en post_deploy.sh:"
echo "  Usuario: admin"
echo "  Password: 1234"
echo ""
echo "URL de admin en Render:"
echo "  https://soptraloc.onrender.com/admin/"
echo "  (verifica en Render Dashboard si es diferente)"
echo ""

echo "============================================================"
echo "üîç SIGUIENTE PASO:"
echo "============================================================"
echo ""
echo "1. Accede al Shell de Render"
echo "2. Verifica si el usuario existe"
echo "3. Si no existe, cr√©alo manualmente"
echo "4. Si existe pero la contrase√±a no funciona, reset√©ala"
echo ""
echo "============================================================"
